# ============================================
# Powder Toy 开发环境配置
# ============================================

# 创建并激活 Python 虚拟环境
layout python python3

# 设置项目根目录
export PROJECT_ROOT=$(pwd)

# 将虚拟环境的 bin 目录添加到 PATH
export PATH=$PROJECT_ROOT/.venv/bin:$PATH

# 设置编译器缓存（如果安装了 ccache）
if command -v ccache >/dev/null 2>&1; then
    export CC="ccache gcc"
    export CXX="ccache g++"
    export CCACHE_DIR=$PROJECT_ROOT/.ccache
fi

# 设置 PKG_CONFIG_PATH（如果需要）
export PKG_CONFIG_PATH=/usr/lib/pkgconfig:/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH

# Meson 构建目录
export MESON_BUILD_DIR=$PROJECT_ROOT/build

# 安装 Python 依赖
if [ ! -f .venv/bin/meson ]; then
    echo "正在安装 Python 依赖..."
    pip install --upgrade pip
    pip install meson ninja
fi

echo "✓ Powder Toy 开发环境已激活"
echo "  Python: $(python --version)"
echo "  Meson: $(meson --version 2>/dev/null || echo 'not installed')"

# ============================================
# 系统依赖说明（需要手动安装）
# ============================================
# 请确保已安装以下系统依赖：
#
# sudo apt update
# sudo apt install -y \
#     g++ \
#     git \
#     python3 \
#     python3-pip \
#     python3-venv \
#     pkg-config \
#     ccache \
#     libluajit-5.1-dev \
#     libcurl4-openssl-dev \
#     libssl-dev \
#     libfftw3-dev \
#     libsdl2-dev \
#     libbz2-dev \
#     libjsoncpp-dev \
#     libpng-dev
